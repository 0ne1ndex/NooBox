!function(e){function a(i){if(t[i])return t[i].exports;var n=t[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}var t={};return a.m=e,a.c=t,a.p="",a(0)}([function(e,a){"use strict";function t(e){n||(bello.pageview(i.Options.constantValues[1][1]),n=!0);var a=(new Date).getTime();(!r[e.category]||r[e.category]+500<a)&&(r[e.category]=a),bello.event({category:e.category,action:e.action,label:e.label})}var i={},n=!1,r={};i.temp={lastVideoControl:0},i.Image={},i.Webmaster={},i.History={},i.Options={},i.Notifications={},i.Options.init=null,i.Options.defaultValues=null,i.Image.reverseSearchCursor=0,i.Image.fetchFunctions={},i.Image.handles={},i.Image.POST={},i.Image.POST.servers=["ainoob.com"],i.Image.POST.serverOrder=[0],i.Image.POST.server={},i.Image.POST.general=null,i.Image.POST.upload=null,i.Image.updateContextMenu=null,i.Image.engines=["google","baidu","tineye","bing","yandex","saucenao","iqdb","ascii2d"],i.Image.apiUrls=null,i.Image.imageSearch=null,i.Image.update=null,i.Image.screenshotSearch=null,i.Image.extractImages=null,i.Image.downloadExtractImages=null,i.History.recordImageSearch=null,i.Notifications.notImage=function(){chrome.notifications.create({type:"basic",iconUrl:"/images/icon_128.png",title:GL("reverse_image_search"),message:GL("ls_0")})},i.Options.defaultValues=[["userId",(Math.random().toString(36)+"00000000000000000").slice(2,19)],["imageSearch",!0],["shorcut",!1],["unitsConverter",!1],["crypter",!0],["webmaster",!0],["general",!0],["background",!1],["imageSearchUrl_google",!0],["imageSearchUrl_baidu",!0],["imageSearchUrl_tineye",!0],["imageSearchUrl_bing",!0],["imageSearchUrl_yandex",!0],["imageSearchUrl_saucenao",!1],["imageSearchUrl_iqdb",!1],["imageSearchUrl_sogou",!1],["imageSearchUrl_ascii2d",!1],["extractImages",!0],["screenshotSearch",!0],["videoControl",!1],["displayOrder",[]],["checkUpdate",!0],["lastUpdateCheck",0],["updateHistory",[]],["history",!0]],i.Options.constantValues=[["displayList",["imageSearch","videoControl","checkUpdate"]],["version","0.9.4.0"]],i.Options.init=function(e){var a=i.Options.constantValues;e<a.length&&set(a[e][0],a[e][1]);var t=i.Options.defaultValues;e<t.length?setIfNull(t[e][0],t[e][1],i.Options.init.bind(null,e+1)):i.Image.updateContextMenu()},i.Image.init=function(){},i.Image.updateContextMenu=function(){isOn("imageSearch",function(){i.Image.handles.imageSearch||(i.Image.handles.imageSearch=chrome.contextMenus.create({title:GL("search_this_image"),contexts:["image"],onclick:i.Image.imageSearch}))},function(){i.Image.handles.imageSearch&&(chrome.contextMenus.remove(i.Image.handles.imageSearch),i.Image.handles.imageSearch=null)}),isOn("extractImages",function(){i.Image.handles.extractImages||(i.Image.handles.extractImages=chrome.contextMenus.create({id:"extractImages",title:GL("extract_images"),contexts:["all"],onclick:i.Image.extractImages}))},function(){i.Image.handles.extractImages&&(chrome.contextMenus.remove(i.Image.handles.extractImages),i.Image.handles.extractImages=null)}),isOn("screenshotSearch",function(){i.Image.handles.screenshotSearch||(i.Image.handles.screenshotSearch=chrome.contextMenus.create({id:"screenshotSearch",title:GL("screenshot_search"),contexts:["all"],onclick:i.Image.screenshotSearch}))},function(){i.Image.handles.screenshotSearch&&(chrome.contextMenus.remove(i.Image.handles.screenshotSearch),i.Image.handles.screenshotSearch=null)})},i.Image.imageSearch=function(e){var a=e.srcUrl||e;getDB("imageCursor",function(n){"number"==typeof n?n++:n=0,setDB("imageCursor",n),i.History.recordImageSearch(n,e),getImageSearchEngines(i.Image.engines,function(e){for(var r="dataURI",o={engines:e},s=0;s<e.length;s++)o[e[s]]={result:"loading"};var c=encodeURI(a);c.match(/^data/)?(o.imageUrl="dataURI",o.dataURI=c,i.Image.POST.general(n,o,e,o.dataURI)):(r="url",o.imageUrl=a,i.Image.imageSearchByUrl(n,o,e));var l=o.imageUrl;"dataURI"!=l&&(l="url");var g="/image.search.html?cursor="+n+"&image="+l;chrome.tabs.create({url:g}),i.Image.update(n,o),t({category:"imageSearch",action:r,label:l})})})},i.Image.imageSearchByUrl=function(e,a,t){for(var n=0;n<t.length;n++)!function(e,t){var n=i.Image.generateAjaxRequest(t,a);$.ajax(n).done(function(n){i.Image.fetchFunctions[t](e,a,n)}).fail(function(n){a[t].result="failed",i.Image.update(e,a),console.log(n)})}(e,t[n])},i.Image.generateAjaxRequest=function(e,a){var t=a.uploadedURL||a.imageUrl;a[e].url=i.Image.apiUrls[e]+t;var n={success:function(t,i,n){n.getResponseHeader("Location")&&(console.log(n.getResponseHeader("Location")),a[e].url=n.getResponseHeader("Location"))}};switch(e){case"ascii2d":n.url=i.Image.apiUrls[e],n.method="POST",n.data={uri:t},console.log("ascii2d!!!!");break;default:n.url=a[e].url}return n},i.Image.apiUrls={google:"https://www.google.com/searchbyimage?&image_url=",baidu:"https://image.baidu.com/n/pc_search?queryImageUrl=",tineye:"http://www.tineye.com/search/?url=",bing:"http://www.bing.com/images/search?view=detailv2&iss=sbi&q=imgurl:",yandex:"https://www.yandex.com/images/search?rpt=imageview&img_url=",saucenao:"http://saucenao.com/search.php?db=999&url=",iqdb:"http://iqdb.org/?url=",sogou:"http://pic.sogou.com/ris?query=",ascii2d:"https://ascii2d.net/search/uri"},i.Image.fetchFunctions.google=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,"");var n=$(t),r=n.find("._gUb").text(),o=[],s=$(n.find("#rso").find("._NId")[0]).find(".rc")||[];0==s.length&&(s=$(n.find("#rso").find(".rgsep")[0]).prev().find(".rc")||[]);for(var c=0;c<s.length;c++){var l={link:"",title:"",description:"",searchEngine:"google",related:!0},g=$(s[c]),d=g.find("a")[0]||{};l.link=d.href,l.title=d.innerText;var u=g.find(".s").find(".st")[0]||{};l.description=u.innerHTML,o.push(l)}var m=[],h=$(n.find("#rso").find("._NId")).last().find(".rc")||[];0==h.length&&(h=$(n.find("#rso").find(".rgsep")).last().prev().find(".rc")||[]);for(var f=0;f<h.length;f++){var p={link:"",title:"",description:"",searchEngine:"google",related:!1},b=$(h[f]),I=b.find("a")[0]||{};p.link=I.href,p.title=I.innerText;var v=b.find(".s").find(".st")[0]||{};p.description=v.innerHTML;var x=b.find("._lyb").find("a")[0]||{};if(x.href){var y=x.href.indexOf("imgurl=")+7,S=x.href.indexOf("&",y);S==-1?p.imageUrl=x.href.slice(y):p.imageUrl=x.href.slice(y,S)}if(p.imageUrl){var U=p.imageUrl.indexOf("jpg%");U!=-1&&(p.imageUrl=p.imageUrl.slice(0,U+3)),U=p.imageUrl.indexOf("png%"),U!=-1&&(p.imageUrl=p.imageUrl.slice(0,U+3)),U=p.imageUrl.indexOf("gif%"),U!=-1&&(p.imageUrl=p.imageUrl.slice(0,U+3))}m.push(p)}a.google.keyword=r,a.google.relatedWebsites=o,a.google.websites=m,a.google.result="done",i.Image.update(e,a)}catch(t){console.log(t),a.google.result="failed",i.Image.update(e,a)}},i.Image.fetchFunctions.baidu=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,"");for(var n=$(t),r=n.find(".guess-info-word-link").text()||n.find(".guess-info-text-link").text(),o=[],s=n.find(".guess-baike").find(".guess-baike-title").find("a"),c=n.find(".guess-baike").find(".guess-baike-text")||[],l=0;l<s.length;l++){var g={};g.link=s[l].href,g.title=s[l].innerText,g.description=c[l].innerHTML,g.searchEngine="baidu",g.related=!0,o.push(g)}s=n.find(".guess-newbaike").find(".guess-newbaike-text-title").find("a"),c=n.find(".guess-newbaike").find(".guess-newbaike-text-box")||[];for(var d=0;d<s.length;d++){var u={};u.link=s[d].href,u.title=s[d].innerText,u.description=c[d].innerHTML,u.searchEngine="baidu",u.related=!0,o.push(u)}for(var m=[],h=n.find(".source-card-topic")||[],f=0;f<h.length;f++){var p={searchEngine:"baidu"},b=$(h[f]),I=b.find("a")[0]||{};p.link=I.href,p.title=I.innerText;var v=b.find(".source-card-topic-content")[0]||{};p.description=v.innerHTML;var x=b.find(".source-card-topic-same-image")[0];if(x){var y=x.style.backgroundImage.indexOf("http"),S=x.style.backgroundImage.indexOf('")');p.imageUrl=x.style.backgroundImage.slice(y,S),p.imageUrl=p.imageUrl.replace(/&amp;/g,"")}m.push(p)}a.baidu.keyword=r,a.baidu.relatedWebsites=o,a.baidu.websites=m,a.baidu.result="done",i.Image.update(e,a)}catch(t){console.log(t),a.baidu.result="failed",i.Image.update(e,a)}},i.Image.fetchFunctions.tineye=function(e,a,t){t=t.replace(/<img[^>]*>/g,"");try{t=t.replace(/<img[^>]*>/g,"");for(var n=$(t),r=[],o=[],s=$(n.find(".match"))||[],c=0;c<s.length;c++){var l={searchEngine:"tineye",related:!0,description:""},g=$(s[c]);if(g.find(".top-padding").length>0){l.title=$(g).find("h4")[0].title;var d=g.find(".top-padding").find("a")[0]||{};l.link=d.href,o.push(l)}else{l.title=$(g).find("h4")[0].title;var u=$(g).find("p").find("a")[2]||{};l.link=u.href,l.description=u.href;var m=$(g).find("p").find("a")[1]||{};l.imageUrl=m.href,l.searchEngine="tineye",r.push(l)}}a.tineye.websites=r,a.tineye.relatedWebsites=o,a.tineye.result="done",i.Image.update(e,a)}catch(t){a.tineye.result="failed",i.Image.update(e,a),console.log(t)}},i.Image.fetchFunctions.bing=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,"");var n=$(t).find(".query").text();a.bing.keyword=n,a.bing.result="done",i.Image.update(e,a)}catch(t){a.bing.result="failed",i.Image.update(e,a),console.log(t)}},i.Image.fetchFunctions.yandex=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,"");for(var n=$(t),r=[],o=$(n.find(".other-sites__item"))||[],s=0;s<o.length;s++){var c={},l=$(o[s]),g=l.find(".other-sites__snippet").find("a")[0]||{};c.link=g.href,c.title=g.innerText;var d=l.find(".other-sites__desc")[0]||{};c.description=d.innerHTML;var u=l.find(".other-sites__preview-link")[0]||{};c.imageUrl=u.href,c.searchEngine="yandex",r.push(c)}a.yandex.websites=r,a.yandex.result="done",i.Image.update(e,a)}catch(t){a.yandex.result="failed",i.Image.update(e,a),console.log(t)}},i.Image.fetchFunctions.saucenao=function(e,a,t){try{t=t.replace(/ src=/g," nb-src=");for(var n=$(t),r=[],o=[],s=$(n.find(".result"))||[],c=0;c<s.length;c++){var l={imageUrl:"",searchEngine:"saucenao",related:!0},g=$(s[c]);l.link="",l.title="";var d=g.find(".resulttable")[0];if(!d)break;l.description=d.innerHTML.replace(/(nb-src="\/image|nb-src="image)/g,'src="http://saucenao.com/image');var u=g.find(".resultimage").find("img")[0];u&&(l.imageUrl=u.getAttribute("nb-src"));var m=g.find(".resultsimilarityinfo").text();m.replace("%","")>90?o.push(l):r.push(l)}a.saucenao.relatedWebsites=o,a.saucenao.websites=r,a.saucenao.result="done",i.Image.update(e,a)}catch(t){a.saucenao.result="failed",i.Image.update(e,a),console.log(t)}},i.Image.fetchFunctions.iqdb=function(e,a,t){try{t=t.replace(/ src=\'\/([^\/])/g," nb-src='$1"),t=t.replace(/ src=\"\/\//g,' nb1-src="'),t=t.replace(/ href=\"\/\//g,' nb-href="');for(var n=$(t),r=[],o=$(n.find("table"))||[],s=1;s<o.length-2;s++){var c="<table>"+o[s].innerHTML.replace(/nb-src="/g,'src="http://iqdb.org/')+"</table>";c=c.replace(/nb1-src="/g,'src="http://'),c=c.replace(/nb-href="/g,'href="http://');var l={link:"",title:"",imageUrl:"",searchEngine:"iqdb",description:c,related:!0};o[s].innerHTML.indexOf("Best match")!=-1?a.iqdb.relatedWebsites=[l]:r.push(l)}a.iqdb.websites=[],a.iqdb.result="done",i.Image.update(e,a)}catch(t){a.iqdb.result="failed",i.Image.update(e,a),console.log(t)}};var o;i.Image.fetchFunctions.ascii2d=function(e,a,t){try{t=t.replace(/<img/g,"<nooboximage");for(var n=$(t),r=[],o=[],s=$(n.find(".item-box"))||[],c=1;c<s.length;c++){var l={searchEngine:"ascii2d",description:""},g=s[c];g=$(g);var d=$(g).find(".detail-box a")[0]||{};l.title=d.innerText,l.link=d.href,l.description=($(g).find("h6")[0]||{innerHTML:""}).innerHTML.replace(/<nooboximage/g,"<img"),l.imageUrl="https://ascii2d.net/"+$(g).find("nooboximage").attr("src"),l.searchEngine="ascii2d",1==c?o.push(l):r.push(l)}a.ascii2d.websites=r,a.ascii2d.relatedWebsites=o,a.ascii2d.result="done",i.Image.update(e,a)}catch(t){a.ascii2d.result="failed",i.Image.update(e,a),console.log(t)}},i.Image.fetchFunctions.sogou=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,""),o=$(t);var n=[];a.sogou.websites=n,a.sogou.result="done",i.Image.update(e,a)}catch(t){a.sogou.result="failed",i.Image.update(e,a),console.log(t)}},i.Image.POST.general=function(e,a,t,n,r){r?i.Image.imageSearchByUrl(e,a,t):i.Image.POST.upload(e,a,n,i.Image.POST.general.bind(null,e,a,t,null))},i.Image.POST.upload=function(e,a,t,i){$.ajax({type:"POST",url:"https://ainoob.com/api/uploadImage/",contentType:"application/json",data:JSON.stringify({data:t})}).done(function(e){a.uploadedURL="https://ainoob.com/api/getImage/"+e,i(a.uploadedURL)})},i.Image.update=function(e,a){setDB("NooBox.Image.result_"+e,a,function(){chrome.runtime.sendMessage({job:"image_result_update",cursor:e},function(e){})})},i.Image.extractImages=function(e,a){try{chrome.tabs.sendMessage(a.id,{job:"extractImages"},{frameId:e.frameId},function(e){e||chrome.notifications.create("extractImages",{type:"basic",iconUrl:"/images/icon_128.png",title:chrome.i18n.getMessage("extractImages"),message:chrome.i18n.getMessage("ls_4")},voidFunc)})}catch(e){chrome.tabs.sendMessage(a.id,{job:"extractImages"},function(e){e||chrome.notifications.create("extractImages",{type:"basic",iconUrl:"/images/icon_128.png",title:chrome.i18n.getMessage("extractImages"),message:chrome.i18n.getMessage("ls_4")},voidFunc)})}},i.Image.downloadExtractImages=function(e,a){function i(t){if(t){var g=(t.slice(0,20).match(/image\/(\w*)/)||["",""])[1],d=convertDataURIToBinary(t);n.file(c.name+"."+g,d,{base64:!1})}else o--;r--,chrome.tabs.sendMessage(e.tab.id,{job:"downloadRemaining",remains:r,total:o},function(){}),0==r?n.generateAsync({type:"blob"}).then(function(e){saveAs(e,"NooBox.zip")}):(c=a[++s],"data"==c.url.slice(0,4)?i(c.url):fetchBlob(c.url,function(e){e?l.readAsDataURL(e):i()}))}t({category:"downloadExtractImages",action:"run"});var n=new JSZip,r=a.length,o=a.length,s=0,c=a[s],l=new window.FileReader;l.onloadend=function(){console.log(r),i(l.result)},"data"==c.url.slice(0,4)?i(c.url):fetchBlob(c.url,function(e){e?l.readAsDataURL(e):i()})},i.Image.screenshotSearch=function(e,a){chrome.tabs.sendMessage(a.id,"loaded",function(e){"yes"==e?chrome.tabs.captureVisibleTab(a.windowId,function(e){chrome.tabs.sendMessage(a.id,{job:"screenshotSearch",data:e})}):chrome.tabs.captureVisibleTab(a.windowId,function(e){chrome.tabs.executeScript(a.id,{file:"thirdParty/jquery.min.js"},function(){return chrome.runtime.lastError?void chrome.notifications.create("screenshotFailed",{type:"basic",iconUrl:"/images/icon_128.png",title:GL("ls_1"),message:GL("ls_2")},voidFunc):void chrome.tabs.executeScript(a.id,{file:"js/screenshotSearch.js"},function(){chrome.tabs.sendMessage(a.id,{job:"screenshotSearch",data:e})})})})})},i.History.recordImageSearch=function(e,a){get("totalImageSearch",function(e){e=e||0,set("totalImageSearch",parseInt(e)+1)}),isOn("history",function(){getDB("history_records",function(t){t=t||[];var i=a.srcUrl||a;t.push({date:(new Date).getTime(),event:"search",cursor:e,info:i}),setDB("history_records",t)})})},i.init=function(){window.NooBox=i,i.Options.init(0),i.Image.init(),chrome.runtime.onMessage.addListener(function(e,a,n){if("job"in e)if("imageSearch_upload"==e.job||"imageSearch_reSearch"==e.job)"imageSearch_reSerach"==e.job&&t({category:"uploadReSearch",action:"run"}),i.Image.imageSearch(e.data);else if("imageSearch"==e.job||"extractImages"==e.job||"screenshotSearch"==e.job)i.Image.updateContextMenu();else if("analytics"==e.job)t(e);else if("uploadImage"==e.job)console.log("uploadImage"),i.Image.imageFileSelector.click();else if("passToFront"==e.job)chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.tabs.sendMessage(a[0].id,e.message,function(){})});else if("notImage"==e.job)chrome.NooBox.Notifications.notImage;else if("getDB"==e.job)getDB(e.key,function(t){chrome.tabs.sendMessage(a.tab.id,{job:"returnDB",key:e.key,data:t})});else if("urlDownloadZip"==e.job)i.Image.downloadExtractImages(a,e.files);else if("videoControl_website_switch"==e.job){var r="enable";e.enable&&(r="disable"),t({category:"videoControlWebsiteSwitch",action:r,label:""}),chrome.tabs.query({},function(a){for(var t=0;t<a.length;t++)a[t].url.indexOf(e.host)&&chrome.tabs.sendMessage(a[t].id,{job:"videoConrolContentScriptSwitch",enabled:e.enabled},function(){})})}else if("videoControl_use"==e.job){var o=(new Date).getTime();i.temp.lastVideoControl+6e5<o&&(i.temp.lastVideoControl=o,t({category:"videoControl",action:"run",label:""}),get("userId",function(e){get("version",function(a){var t={userId:e,url:"videoControl",title:document.title,time:(new Date).toLocaleString(),version:a};$.ajax({type:"POST",url:"https://ainoob.com/api/noobox/user/",contentType:"application/json",data:JSON.stringify(t)})})}))}})},document.addEventListener("DOMContentLoaded",i.init)}]);