!function(e){function a(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}var t={};return a.m=e,a.c=t,a.p="",a(0)}([function(e,a){"use strict";function t(e){i||(bello.pageview(n.Options.constantValues[1][1]),i=!0);var a=(new Date).getTime();(!r[e.category]||r[e.category]+500<a)&&(r[e.category]=a),bello.event({category:e.category,action:e.action,label:e.label})}var n={},i=!1,r={};n.temp={lastVideoControl:0},n.Image={},n.Webmaster={},n.History={},n.Options={},n.Notifications={},n.Options.init=null,n.Options.defaultValues=null,n.Image.reverseSearchCursor=0,n.Image.fetchFunctions={},n.Image.handles={},n.Image.POST={},n.Image.POST.servers=["ainoob.com"],n.Image.POST.serverOrder=[0],n.Image.POST.server={},n.Image.POST.general=null,n.Image.POST.upload=null,n.Image.updateContextMenu=null,n.Image.engines=["google","baidu","tineye","bing","yandex","saucenao","iqdb","ascii2d"],n.Image.apiUrls=null,n.Image.imageSearch=null,n.Image.update=null,n.Image.screenshotSearch=null,n.Image.extractImages=null,n.Image.downloadExtractImages=null,n.History.recordImageSearch=null,n.Notifications.notImage=function(){chrome.notifications.create({type:"basic",iconUrl:"/images/icon_128.png",title:GL("reverse_image_search"),message:GL("ls_0")})},n.Options.defaultValues=[["userId",(Math.random().toString(36)+"00000000000000000").slice(2,19)],["imageSearch",!0],["shorcut",!1],["unitsConverter",!1],["crypter",!0],["webmaster",!0],["general",!0],["background",!1],["imageSearchUrl_google",!0],["imageSearchUrl_baidu",!0],["imageSearchUrl_tineye",!0],["imageSearchUrl_bing",!0],["imageSearchUrl_yandex",!0],["imageSearchUrl_saucenao",!1],["imageSearchUrl_iqdb",!1],["imageSearchUrl_sogou",!1],["imageSearchUrl_ascii2d",!1],["extractImages",!0],["screenshotSearch",!0],["videoControl",!1],["displayOrder",[]],["checkUpdate",!0],["lastUpdateCheck",0],["updateHistory",[]],["history",!0]],n.Options.constantValues=[["displayList",["imageSearch","videoControl","checkUpdate"]],["version","0.9.4.1"]],n.Options.init=function(e){var a=n.Options.constantValues;e<a.length&&set(a[e][0],a[e][1]);var t=n.Options.defaultValues;e<t.length?setIfNull(t[e][0],t[e][1],n.Options.init.bind(null,e+1)):n.Image.updateContextMenu()},n.Image.init=function(){},n.Image.updateContextMenu=function(){isOn("imageSearch",function(){n.Image.handles.imageSearch||(n.Image.handles.imageSearch=chrome.contextMenus.create({title:GL("search_this_image"),contexts:["image"],onclick:n.Image.imageSearch}))},function(){n.Image.handles.imageSearch&&(chrome.contextMenus.remove(n.Image.handles.imageSearch),n.Image.handles.imageSearch=null)}),isOn("extractImages",function(){n.Image.handles.extractImages||(n.Image.handles.extractImages=chrome.contextMenus.create({id:"extractImages",title:GL("extract_images"),contexts:["all"],onclick:n.Image.extractImages}))},function(){n.Image.handles.extractImages&&(chrome.contextMenus.remove(n.Image.handles.extractImages),n.Image.handles.extractImages=null)}),isOn("screenshotSearch",function(){n.Image.handles.screenshotSearch||(n.Image.handles.screenshotSearch=chrome.contextMenus.create({id:"screenshotSearch",title:GL("screenshot_search"),contexts:["all"],onclick:n.Image.screenshotSearch}))},function(){n.Image.handles.screenshotSearch&&(chrome.contextMenus.remove(n.Image.handles.screenshotSearch),n.Image.handles.screenshotSearch=null)})},n.Image.imageSearch=function(e){var a=e.srcUrl||e;getDB("imageCursor",function(i){"number"==typeof i?i++:i=0,setDB("imageCursor",i),n.History.recordImageSearch(i,e),getImageSearchEngines(n.Image.engines,function(e){for(var r="dataURI",o={engines:e},s=0;s<e.length;s++)o[e[s]]={result:"loading"};var c=encodeURI(a);c.match(/^data/)?(o.imageUrl="dataURI",o.dataURI=c,n.Image.POST.general(i,o,e,o.dataURI)):(r="url",o.imageUrl=a,n.Image.imageSearchByUrl(i,o,e));var l=o.imageUrl;"dataURI"!=l&&(l="url");var g="/image.search.html?cursor="+i+"&image="+l;chrome.tabs.create({url:g}),n.Image.update(i,o),t({category:"imageSearch",action:r,label:l})})})},n.Image.imageSearchByUrl=function(e,a,t){for(var i=0;i<t.length;i++)!function(e,t){n.Image.imageSearchByUrlEngine2(t,a,e)}(e,t[i])},n.Image.imageSearchByUrlEngine=function(e,a,t){var i=n.Image.generateAjaxRequest(e,a),r=new XMLHttpRequest;r.open(i.method||"GET",i.url,!0),r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&200===r.status&&(a[e].url=r.responseURL,n.Image.fetchFunctions[e](t,a,r.responseText))},r.onerror=function(i){a[e].result="failed",n.Image.update(t,a),console.log(i)},i.contentType&&r.setRequestHeader("Content-Type",i.contentType),r.send(i.data?Object.keys(i.data).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i.data[e])}).join("&"):null)},n.Image.generateAjaxRequest=function(e,a){var t=a.uploadedURL||a.imageUrl;a[e].url=n.Image.apiUrls[e]+t;var i={};switch(e){case"ascii2d":i.url=n.Image.apiUrls[e],i.method="POST",i.data={uri:t},i.contentType="application/x-www-form-urlencoded; charset=UTF-8";break;default:i.url=a[e].url}return i},n.Image.apiUrls={google:"https://www.google.com/searchbyimage?&image_url=",baidu:"https://image.baidu.com/n/pc_search?queryImageUrl=",tineye:"http://www.tineye.com/search/?url=",bing:"http://www.bing.com/images/search?view=detailv2&iss=sbi&q=imgurl:",yandex:"https://www.yandex.com/images/search?rpt=imageview&img_url=",saucenao:"http://saucenao.com/search.php?db=999&url=",iqdb:"http://iqdb.org/?url=",sogou:"http://pic.sogou.com/ris?query=",ascii2d:"https://ascii2d.net/search/uri"},n.Image.fetchFunctions.google=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,"");var i=$(t),r=i.find("._gUb").text(),o=[],s=$(i.find("#rso").find("._NId")[0]).find(".rc")||[];0==s.length&&(s=$(i.find("#rso").find(".rgsep")[0]).prev().find(".rc")||[]);for(var c=0;c<s.length;c++){var l={link:"",title:"",description:"",searchEngine:"google",related:!0},g=$(s[c]),d=g.find("a")[0]||{};l.link=d.href,l.title=d.innerText;var u=g.find(".s").find(".st")[0]||{};l.description=u.innerHTML,o.push(l)}var m=[],h=$(i.find("#rso").find("._NId")).last().find(".rc")||[];0==h.length&&(h=$(i.find("#rso").find(".rgsep")).last().prev().find(".rc")||[]);for(var f=0;f<h.length;f++){var p={link:"",title:"",description:"",searchEngine:"google",related:!1},b=$(h[f]),I=b.find("a")[0]||{};p.link=I.href,p.title=I.innerText;var v=b.find(".s").find(".st")[0]||{};p.description=v.innerHTML;var y=b.find("._lyb").find("a")[0]||{};if(y.href){var x=y.href.indexOf("imgurl=")+7,S=y.href.indexOf("&",x);S==-1?p.imageUrl=y.href.slice(x):p.imageUrl=y.href.slice(x,S)}if(p.imageUrl){var U=p.imageUrl.indexOf("jpg%");U!=-1&&(p.imageUrl=p.imageUrl.slice(0,U+3)),U=p.imageUrl.indexOf("png%"),U!=-1&&(p.imageUrl=p.imageUrl.slice(0,U+3)),U=p.imageUrl.indexOf("gif%"),U!=-1&&(p.imageUrl=p.imageUrl.slice(0,U+3))}m.push(p)}a.google.keyword=r,a.google.relatedWebsites=o,a.google.websites=m,a.google.result="done",n.Image.update(e,a)}catch(t){console.log(t),a.google.result="failed",n.Image.update(e,a)}},n.Image.fetchFunctions.baidu=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,"");for(var i=$(t),r=i.find(".guess-info-word-link").text()||i.find(".guess-info-text-link").text(),o=[],s=i.find(".guess-baike").find(".guess-baike-title").find("a"),c=i.find(".guess-baike").find(".guess-baike-text")||[],l=0;l<s.length;l++){var g={};g.link=s[l].href,g.title=s[l].innerText,g.description=c[l].innerHTML,g.searchEngine="baidu",g.related=!0,o.push(g)}s=i.find(".guess-newbaike").find(".guess-newbaike-text-title").find("a"),c=i.find(".guess-newbaike").find(".guess-newbaike-text-box")||[];for(var d=0;d<s.length;d++){var u={};u.link=s[d].href,u.title=s[d].innerText,u.description=c[d].innerHTML,u.searchEngine="baidu",u.related=!0,o.push(u)}for(var m=[],h=i.find(".source-card-topic")||[],f=0;f<h.length;f++){var p={searchEngine:"baidu"},b=$(h[f]),I=b.find("a")[0]||{};p.link=I.href,p.title=I.innerText;var v=b.find(".source-card-topic-content")[0]||{};p.description=v.innerHTML;var y=b.find(".source-card-topic-same-image")[0];if(y){var x=y.style.backgroundImage.indexOf("http"),S=y.style.backgroundImage.indexOf('")');p.imageUrl=y.style.backgroundImage.slice(x,S),p.imageUrl=p.imageUrl.replace(/&amp;/g,"")}m.push(p)}a.baidu.keyword=r,a.baidu.relatedWebsites=o,a.baidu.websites=m,a.baidu.result="done",n.Image.update(e,a)}catch(t){console.log(t),a.baidu.result="failed",n.Image.update(e,a)}},n.Image.fetchFunctions.tineye=function(e,a,t){t=t.replace(/<img[^>]*>/g,"");try{t=t.replace(/<img[^>]*>/g,"");for(var i=$(t),r=[],o=[],s=$(i.find(".match"))||[],c=0;c<s.length;c++){var l={searchEngine:"tineye",related:!0,description:""},g=$(s[c]);if(g.find(".top-padding").length>0){l.title=$(g).find("h4")[0].title;var d=g.find(".top-padding").find("a")[0]||{};l.link=d.href,o.push(l)}else{l.title=$(g).find("h4")[0].title;var u=$(g).find("p").find("a")[2]||{};l.link=u.href,l.description=u.href;var m=$(g).find("p").find("a")[1]||{};l.imageUrl=m.href,l.searchEngine="tineye",r.push(l)}}a.tineye.websites=r,a.tineye.relatedWebsites=o,a.tineye.result="done",n.Image.update(e,a)}catch(t){a.tineye.result="failed",n.Image.update(e,a),console.log(t)}},n.Image.fetchFunctions.bing=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,"");var i=$(t).find(".query").text();a.bing.keyword=i,a.bing.result="done",n.Image.update(e,a)}catch(t){a.bing.result="failed",n.Image.update(e,a),console.log(t)}},n.Image.fetchFunctions.yandex=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,"");for(var i=$(t),r=[],o=$(i.find(".other-sites__item"))||[],s=0;s<o.length;s++){var c={},l=$(o[s]),g=l.find(".other-sites__snippet").find("a")[0]||{};c.link=g.href,c.title=g.innerText;var d=l.find(".other-sites__desc")[0]||{};c.description=d.innerHTML;var u=l.find(".other-sites__preview-link")[0]||{};c.imageUrl=u.href,c.searchEngine="yandex",r.push(c)}a.yandex.websites=r,a.yandex.result="done",n.Image.update(e,a)}catch(t){a.yandex.result="failed",n.Image.update(e,a),console.log(t)}},n.Image.fetchFunctions.saucenao=function(e,a,t){try{t=t.replace(/ src=/g," nb-src=");for(var i=$(t),r=[],o=[],s=$(i.find(".result"))||[],c=0;c<s.length;c++){var l={imageUrl:"",searchEngine:"saucenao",related:!0},g=$(s[c]);l.link="",l.title="";var d=g.find(".resulttable")[0];if(!d)break;l.description=d.innerHTML.replace(/(nb-src="\/image|nb-src="image)/g,'src="http://saucenao.com/image');var u=g.find(".resultimage").find("img")[0];u&&(l.imageUrl=u.getAttribute("nb-src"));var m=g.find(".resultsimilarityinfo").text();m.replace("%","")>90?o.push(l):r.push(l)}a.saucenao.relatedWebsites=o,a.saucenao.websites=r,a.saucenao.result="done",n.Image.update(e,a)}catch(t){a.saucenao.result="failed",n.Image.update(e,a),console.log(t)}},n.Image.fetchFunctions.iqdb=function(e,a,t){try{t=t.replace(/ src=\'\/([^\/])/g," nb-src='$1"),t=t.replace(/ src=\"\/\//g,' nb1-src="'),t=t.replace(/ href=\"\/\//g,' nb-href="');for(var i=$(t),r=[],o=$(i.find("table"))||[],s=1;s<o.length-2;s++){var c="<table>"+o[s].innerHTML.replace(/nb-src="/g,'src="http://iqdb.org/')+"</table>";c=c.replace(/nb1-src="/g,'src="http://'),c=c.replace(/nb-href="/g,'href="http://');var l={link:"",title:"",imageUrl:"",searchEngine:"iqdb",description:c,related:!0};o[s].innerHTML.indexOf("Best match")!=-1?a.iqdb.relatedWebsites=[l]:r.push(l)}a.iqdb.websites=[],a.iqdb.result="done",n.Image.update(e,a)}catch(t){a.iqdb.result="failed",n.Image.update(e,a),console.log(t)}};var o;n.Image.fetchFunctions.ascii2d=function(e,a,t){try{t=t.replace(/<img/g,"<nooboximage");for(var i=$(t),r=[],o=[],s=$(i.find(".item-box"))||[],c=1;c<s.length;c++){var l={searchEngine:"ascii2d",description:""},g=s[c];g=$(g);var d=$(g).find(".detail-box a")[0]||{};l.title=d.innerText,l.link=d.href,l.description=($(g).find("h6")[0]||{innerHTML:""}).innerHTML.replace(/<nooboximage/g,"<img"),l.imageUrl="https://ascii2d.net/"+$(g).find("nooboximage").attr("src"),l.searchEngine="ascii2d",1==c?o.push(l):r.push(l)}a.ascii2d.websites=r,a.ascii2d.relatedWebsites=o,a.ascii2d.result="done",n.Image.update(e,a)}catch(t){a.ascii2d.result="failed",n.Image.update(e,a),console.log(t)}},n.Image.fetchFunctions.sogou=function(e,a,t){try{t=t.replace(/<img[^>]*>/g,""),o=$(t);var i=[];a.sogou.websites=i,a.sogou.result="done",n.Image.update(e,a)}catch(t){a.sogou.result="failed",n.Image.update(e,a),console.log(t)}},n.Image.POST.general=function(e,a,t,i,r){r?n.Image.imageSearchByUrl(e,a,t):n.Image.POST.upload(e,a,i,n.Image.POST.general.bind(null,e,a,t,null))},n.Image.POST.upload=function(e,a,t,n){$.ajax({type:"POST",url:"https://ainoob.com/api/uploadImage/",contentType:"application/json",data:JSON.stringify({data:t})}).done(function(e){a.uploadedURL="https://ainoob.com/api/getImage/"+e,n(a.uploadedURL)})},n.Image.update=function(e,a){setDB("NooBox.Image.result_"+e,a,function(){chrome.runtime.sendMessage({job:"image_result_update",cursor:e},function(e){})})},n.Image.extractImages=function(e,a){try{chrome.tabs.sendMessage(a.id,{job:"extractImages"},{frameId:e.frameId},function(e){e||chrome.notifications.create("extractImages",{type:"basic",iconUrl:"/images/icon_128.png",title:chrome.i18n.getMessage("extractImages"),message:chrome.i18n.getMessage("ls_4")},voidFunc)})}catch(e){chrome.tabs.sendMessage(a.id,{job:"extractImages"},function(e){e||chrome.notifications.create("extractImages",{type:"basic",iconUrl:"/images/icon_128.png",title:chrome.i18n.getMessage("extractImages"),message:chrome.i18n.getMessage("ls_4")},voidFunc)})}},n.Image.downloadExtractImages=function(e,a){function n(t){if(t){var g=(t.slice(0,20).match(/image\/(\w*)/)||["",""])[1],d=convertDataURIToBinary(t);i.file(c.name+"."+g,d,{base64:!1})}else o--;r--,chrome.tabs.sendMessage(e.tab.id,{job:"downloadRemaining",remains:r,total:o},function(){}),0==r?i.generateAsync({type:"blob"}).then(function(e){saveAs(e,"NooBox.zip")}):(c=a[++s],"data"==c.url.slice(0,4)?n(c.url):fetchBlob(c.url,function(e){e?l.readAsDataURL(e):n()}))}t({category:"downloadExtractImages",action:"run"});var i=new JSZip,r=a.length,o=a.length,s=0,c=a[s],l=new window.FileReader;l.onloadend=function(){console.log(r),n(l.result)},"data"==c.url.slice(0,4)?n(c.url):fetchBlob(c.url,function(e){e?l.readAsDataURL(e):n()})},n.Image.screenshotSearch=function(e,a){chrome.tabs.sendMessage(a.id,"loaded",function(e){"yes"==e?chrome.tabs.captureVisibleTab(a.windowId,function(e){chrome.tabs.sendMessage(a.id,{job:"screenshotSearch",data:e})}):chrome.tabs.captureVisibleTab(a.windowId,function(e){chrome.tabs.executeScript(a.id,{file:"thirdParty/jquery.min.js"},function(){return chrome.runtime.lastError?void chrome.notifications.create("screenshotFailed",{type:"basic",iconUrl:"/images/icon_128.png",title:GL("ls_1"),message:GL("ls_2")},voidFunc):void chrome.tabs.executeScript(a.id,{file:"js/screenshotSearch.js"},function(){chrome.tabs.sendMessage(a.id,{job:"screenshotSearch",data:e})})})})})},n.History.recordImageSearch=function(e,a){get("totalImageSearch",function(e){e=e||0,set("totalImageSearch",parseInt(e)+1)}),isOn("history",function(){getDB("history_records",function(t){t=t||[];var n=a.srcUrl||a;t.push({date:(new Date).getTime(),event:"search",cursor:e,info:n}),setDB("history_records",t)})})},n.init=function(){window.NooBox=n,n.Options.init(0),n.Image.init(),chrome.runtime.onMessage.addListener(function(e,a,i){if("job"in e)if("imageSearch_upload"==e.job||"imageSearch_reSearch"==e.job)"imageSearch_reSerach"==e.job&&t({category:"uploadReSearch",action:"run"}),n.Image.imageSearch(e.data);else if("imageSearch"==e.job||"extractImages"==e.job||"screenshotSearch"==e.job)n.Image.updateContextMenu();else if("analytics"==e.job)t(e);else if("uploadImage"==e.job)console.log("uploadImage"),n.Image.imageFileSelector.click();else if("passToFront"==e.job)chrome.tabs.query({active:!0,currentWindow:!0},function(a){chrome.tabs.sendMessage(a[0].id,e.message,function(){})});else if("notImage"==e.job)chrome.NooBox.Notifications.notImage;else if("getDB"==e.job)getDB(e.key,function(t){chrome.tabs.sendMessage(a.tab.id,{job:"returnDB",key:e.key,data:t})});else if("urlDownloadZip"==e.job)n.Image.downloadExtractImages(a,e.files);else if("videoControl_website_switch"==e.job){var r="enable";e.enable&&(r="disable"),t({category:"videoControlWebsiteSwitch",action:r,label:""}),chrome.tabs.query({},function(a){for(var t=0;t<a.length;t++)a[t].url.indexOf(e.host)&&chrome.tabs.sendMessage(a[t].id,{job:"videoConrolContentScriptSwitch",enabled:e.enabled},function(){})})}else if("videoControl_use"==e.job){var o=(new Date).getTime();n.temp.lastVideoControl+6e5<o&&(n.temp.lastVideoControl=o,t({category:"videoControl",action:"run",label:""}),get("userId",function(e){get("version",function(a){var t={userId:e,url:"videoControl",title:document.title,time:(new Date).toLocaleString(),version:a};$.ajax({type:"POST",url:"https://ainoob.com/api/noobox/user/",contentType:"application/json",data:JSON.stringify(t)})})}))}})},document.addEventListener("DOMContentLoaded",n.init)}]);